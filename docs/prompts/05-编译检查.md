# 任务 05: 编译检查

## 任务描述
对数据可视化系统基础框架进行全面编译验证，确保代码构建成功并准备好进行功能实现。

## 前置条件
- 任务 04 成功完成且状态为通过
- 数据可视化框架代码存在于 `code/DataCharts-System/`
- 合规性验证成功完成
- 必要的开发环境已安装

## 任务目标
1. 验证后端 Python 代码编译通过
2. 验证前端 TypeScript/Vue 代码构建通过
3. 验证桌面客户端 PyQt 代码运行通过
4. 检查需要处理的任何警告
5. 生成编译报告

## 详细步骤

### 步骤 1: 环境验证
```bash
# 验证开发环境
python --version
node --version
npm --version

# 导航到系统目录
cd code/DataCharts-System
```

### 步骤 2: 后端 Python 代码验证
```bash
# 运行 Python 代码检查并记录输出
echo "=== 后端 Python 检查 ===" > compilation-report.log
date >> compilation-report.log

# 共享模块检查
python -m py_compile shared/data_types.py 2>&1 | tee -a compilation-report.log
echo "data_types.py 编译退出代码: $?" >> compilation-report.log

python -m py_compile shared/interfaces.py 2>&1 | tee -a compilation-report.log
echo "interfaces.py 编译退出代码: $?" >> compilation-report.log

# 后端 API 检查
python -m py_compile backend/app/main.py 2>&1 | tee -a compilation-report.log
echo "backend main.py 编译退出代码: $?" >> compilation-report.log

# 桌面客户端检查
python -m py_compile desktop/src/main.py 2>&1 | tee -a compilation-report.log
echo "desktop main.py 编译退出代码: $?" >> compilation-report.log

echo "" >> compilation-report.log
```

预期结果：
- [ ] 没有编译错误
- [ ] 退出代码 0（成功）
- [ ] 所有依赖成功解析

### 步骤 3: 前端 Vue/TypeScript 代码验证
```bash
# 运行前端构建并记录输出
echo "=== 前端 Vue/TypeScript 构建 ===" >> compilation-report.log
date >> compilation-report.log

cd frontend

# 安装依赖
npm install 2>&1 | tee -a ../compilation-report.log
echo "npm install 退出代码: $?" >> ../compilation-report.log

# TypeScript 检查
npm run vue-tsc --noEmit 2>&1 | tee -a ../compilation-report.log
echo "TypeScript 检查退出代码: $?" >> ../compilation-report.log

# 构建检查
npm run build 2>&1 | tee -a ../compilation-report.log
echo "构建退出代码: $?" >> ../compilation-report.log

cd ..
echo "" >> compilation-report.log
```

预期结果：
- [ ] 没有编译错误
- [ ] 退出代码 0（成功）
- [ ] 构建制品成功生成
- [ ] 类型检查通过

### 步骤 4: 桌面客户端运行测试
```bash
# 测试桌面客户端基础功能
echo "=== 桌面客户端运行测试 ===" >> compilation-report.log
date >> compilation-report.log

# 检查 PyQt6 导入
python -c "from PyQt6.QtWidgets import QApplication; print('PyQt6 导入成功')" 2>&1 | tee -a compilation-report.log
echo "PyQt6 导入退出代码: $?" >> compilation-report.log

# 检查 PyQt6-Charts 导入
python -c "from PyQt6.QtCharts import QChart; print('PyQt6-Charts 导入成功')" 2>&1 | tee -a compilation-report.log
echo "PyQt6-Charts 导入退出代码: $?" >> compilation-report.log

echo "" >> compilation-report.log
```

### 步骤 5: 依赖检查
```bash
# 检查后端依赖
echo "=== 依赖检查 ===" >> compilation-report.log

# Python 依赖
python -c "import numpy, pandas, sympy, matplotlib, plotly; print('所有 Python 依赖正常')" 2>&1 | tee -a compilation-report.log
echo "Python 依赖检查退出代码: $?" >> compilation-report.log

# Node.js 依赖（在前端目录中）
cd frontend
npm list --depth=0 2>&1 | tee -a ../compilation-report.log
echo "Node.js 依赖列表退出代码: $?" >> ../compilation-report.log
cd ..

echo "" >> compilation-report.log
```

### 步骤 6: 警告分析
```bash
# 检查编译输出中的警告
echo "=== 警告分析 ===" >> compilation-report.log
grep -i "warning\|警告" compilation-report.log | tee warnings-summary.txt
wc -l warnings-summary.txt >> compilation-report.log
```

分析警告类型：
- [ ] 未使用的变量或函数
- [ ] 缺失的文档警告
- [ ] 弃用特性警告
- [ ] 性能警告

### 步骤 7: 系统集成测试（可选）
```bash
# 运行基础集成测试
echo "=== 系统集成测试 ===" >> compilation-report.log

# 启动后端 API（后台）
cd backend
python -c "from app.main import app; print('后端 API 可以导入')" 2>&1 | tee -a ../compilation-report.log
cd ..

# 测试模块间导入
python -c "
import sys
import os
sys.path.append('shared')
from data_types import ChartConfig
from interfaces import DataImportInterface
print('模块间导入成功')
" 2>&1 | tee -a compilation-report.log
```

### 步骤 8: 生成综合编译报告

创建详细编译报告：

```markdown
# 数据可视化系统编译报告

## 环境信息
- **Python 版本**: [python version]
- **Node.js 版本**: [node version]
- **npm 版本**: [npm version]
- **日期**: [编译日期]
- **系统路径**: code/DataCharts-System

## 编译结果

### 后端 Python 编译
**状态**: [通过/失败]
**退出代码**: [退出代码]
**持续时间**: [编译时间]
**问题**: [发现的任何问题]

### 前端 Vue/TypeScript 构建  
**状态**: [通过/失败]
**退出代码**: [退出代码]
**持续时间**: [构建时间]
**生成的制品**: [列出生成的文件]
**问题**: [发现的任何问题]

### 桌面客户端测试
**状态**: [通过/失败]
**PyQt6 导入**: [成功/失败]
**PyQt6-Charts 导入**: [成功/失败]
**问题**: [任何测试失败]

## 依赖分析
**Python 依赖**: [计数]
**Node.js 依赖**: [计数]
**关键依赖状态**:
- NumPy: [状态]
- Pandas: [状态] 
- SymPy: [状态]
- Vue: [状态]
- PyQt6: [状态]

## 警告分析
**总警告数**: [计数]
**警告类别**:
- 未使用代码警告: [计数]
- 文档警告: [计数] 
- 弃用警告: [计数]
- 其他警告: [计数]

**关键警告**: [列出任何关键警告]

## 系统集成测试
**状态**: [通过/失败]
**模块导入**: [成功/失败]
**跨模块通信**: [成功/失败]

## 编译摘要
**整体状态**: [通过/失败]
**准备实现**: [是/否]
**阻塞问题**: [列出任何阻塞问题]

## 下一步
[继续进行或需要修复的建议]
```

### 步骤 9: 验证清单
完成最终验证：

- [ ] **所有编译步骤通过**: 检查、构建、测试都返回退出代码 0
- [ ] **没有编译错误**: 任何步骤都没有错误消息
- [ ] **可管理的警告**: 警告不表示结构问题
- [ ] **基础功能正常**: 冒烟测试通过
- [ ] **依赖已解析**: 没有缺失依赖错误
- [ ] **制品已生成**: 构建产生预期的输出文件

## 成功标准
- [ ] 后端 Python 代码编译成功（退出代码 0）
- [ ] 前端 Vue/TypeScript 构建成功（退出代码 0）  
- [ ] 桌面客户端基础测试通过（退出代码 0）
- [ ] 详细结果的编译报告已生成
- [ ] 没有识别出阻塞编译错误
- [ ] 框架准备进行功能实现
- [ ] 所有验证清单项目已完成

## 输出文件
- `code/DataCharts-System/compilation-report.log`: 详细编译日志
- `code/DataCharts-System/warnings-summary.txt`: 警告分析摘要
- `DataCharts-编译报告.md`: 综合编译报告

## 触发机制
此任务可通过以下方式触发：
1. 手动执行：在系统目录中手动运行编译命令
2. 脚本执行：`./task-runner.sh 05`
3. 自动化 CI：与持续集成管道集成

## 下一任务
- 如果编译**通过**：继续执行 **06-任务分解.md** 进行功能实现规划
- 如果编译**失败**：返回 **03-生成基础框架代码.md** 或 **04-检查代码合规性.md** 进行修复

## 注意事项
- 所有编译步骤必须通过才能认为框架准备就绪
- 在继续实现之前处理关键警告
- 记录任何环境特定的编译要求
- 这完成了基础架构设置阶段