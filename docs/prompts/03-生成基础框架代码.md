# 任务 03: 生成基础框架代码

## 任务描述
基于验证后的架构提示词和设计文档生成数据可视化系统的基础框架代码。此任务实现基础结构，不包含详细功能。

## 前置条件
- 任务 02 成功完成且状态为通过
- `DataCharts-架构提示词.md` 已验证并批准
- 数据可视化设计文档可用
- 理解项目结构要求

## 任务目标
1. 创建数据可视化系统目录结构
2. 生成设计文档中定义的基础数据结构
3. 生成外部接口定义（仅函数签名）
4. 创建必要的配置文件
5. 确保代码编译无错误

## 详细步骤

### 步骤 1: 创建项目目录结构
```bash
# 创建数据可视化系统目录
mkdir -p code/DataCharts-System/frontend/src
mkdir -p code/DataCharts-System/frontend/public
mkdir -p code/DataCharts-System/backend/app
mkdir -p code/DataCharts-System/backend/tests
mkdir -p code/DataCharts-System/desktop/src
mkdir -p code/DataCharts-System/desktop/resources
mkdir -p code/DataCharts-System/shared
mkdir -p code/DataCharts-System/docs
```

### 步骤 2: 生成核心项目文件

#### 创建前端 package.json
```json
{
  "name": "datacharts-frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.3.0",
    "vue-router": "^4.2.0",
    "pinia": "^2.1.0",
    "element-plus": "^2.3.0",
    "echarts": "^5.4.0",
    "chart.js": "^4.3.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.0",
    "typescript": "^5.0.0",
    "vue-tsc": "^1.6.0",
    "vite": "^4.3.0"
  }
}
```

#### 创建后端 requirements.txt
```txt
fastapi==0.100.0
uvicorn==0.22.0
numpy==1.24.0
pandas==2.0.0
sympy==1.12
matplotlib==3.7.0
plotly==5.15.0
sqlalchemy==2.0.0
pydantic==2.0.0
python-multipart==0.0.6
```

#### 创建桌面客户端 requirements.txt
```txt
PyQt6==6.5.0
PyQt6-Charts==6.5.0
numpy==1.24.0
pandas==2.0.0
sympy==1.12
matplotlib==3.7.0
requests==2.31.0
```

### 步骤 3: 生成核心数据结构

#### 创建共享数据类型 `shared/data_types.py`
```python
"""
数据可视化系统核心数据结构

此模块包含设计文档中定义的所有数据结构。
所有结构严格遵循设计规范。
"""

from typing import Any, Dict, List, Optional, Union
from dataclasses import dataclass
from enum import Enum
import numpy as np


@dataclass
class ChartConfig:
    """图表配置结构，来自设计文档"""
    # 严格按照设计文档规范的成员
    chart_type: str
    title: str
    x_axis: str
    y_axis: str
    width: int
    height: int
    options: Dict[str, Any]


@dataclass  
class DataSource:
    """数据源结构，来自设计文档"""
    # 严格按照设计文档规范的成员
    data_id: str
    format: str
    content: Union[str, bytes]
    metadata: Dict[str, Any]


@dataclass
class FunctionExpression:
    """函数表达式结构，来自设计文档"""
    # 严格按照设计文档规范的成员
    expression: str
    variables: List[str]
    parameters: Dict[str, Any]


@dataclass
class ProcessingResult:
    """处理结果结构，来自设计文档"""
    # 严格按照设计文档规范的成员
    result_data: np.ndarray
    processing_time: float
    status: str
    error_message: Optional[str]


class SystemError(Enum):
    """系统错误类型，来自设计文档"""
    # 严格按照设计文档规范的错误类型
    INVALID_INPUT = "invalid_input"
    PROCESSING_ERROR = "processing_error"
    CHART_GENERATION_ERROR = "chart_generation_error"
    FILE_IO_ERROR = "file_io_error"
```

### 步骤 4: 生成外部接口定义

#### 创建接口定义 `shared/interfaces.py`
```python
"""
数据可视化系统外部接口定义

此模块包含设计文档中定义的所有外部接口。
所有接口严格遵循设计规范。
"""

from abc import ABC, abstractmethod
from typing import Any, Dict, List
from .data_types import *


class DataImportInterface(ABC):
    """数据导入接口，来自设计文档"""
    
    @abstractmethod
    def import_data(self, source: DataSource) -> ProcessingResult:
        """导入数据，函数签名待实现"""
        pass
    
    @abstractmethod
    def validate_data(self, data: Any) -> bool:
        """验证数据，函数签名待实现"""
        pass


class FunctionProcessorInterface(ABC):
    """函数处理接口，来自设计文档"""
    
    @abstractmethod
    def parse_expression(self, expr: FunctionExpression) -> bool:
        """解析表达式，函数签名待实现"""
        pass
    
    @abstractmethod
    def apply_function(self, data: np.ndarray, expr: FunctionExpression) -> ProcessingResult:
        """应用函数，函数签名待实现"""
        pass


class ChartGeneratorInterface(ABC):
    """图表生成接口，来自设计文档"""
    
    @abstractmethod
    def create_chart(self, data: np.ndarray, config: ChartConfig) -> str:
        """创建图表，函数签名待实现"""
        pass
    
    @abstractmethod
    def export_chart(self, chart_id: str, format: str) -> bytes:
        """导出图表，函数签名待实现"""
        pass


# API函数定义（来自设计文档）
def initialize_system(config: Dict[str, Any]) -> ProcessingResult:
    """初始化系统，实现待完成"""
    # TODO: 实现待完成
    pass


def shutdown_system() -> ProcessingResult:
    """关闭系统，实现待完成"""
    # TODO: 实现待完成
    pass


def process_data_request(data_source: DataSource, function_expr: FunctionExpression, chart_config: ChartConfig) -> ProcessingResult:
    """处理数据请求，实现待完成"""
    # TODO: 实现待完成
    pass
```

### 步骤 5: 生成主库文件

#### 创建前端主文件 `frontend/src/main.ts`
```typescript
/**
 * 数据可视化系统前端主文件
 * 
 * 根据设计文档规范提供数据可视化功能
 */

import { createApp } from 'vue'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import App from './App.vue'
import router from './router'

const app = createApp(App)

app.use(createPinia())
app.use(router)
app.use(ElementPlus)

app.mount('#app')

// 系统版本信息
export const SYSTEM_VERSION = "0.1.0"

// 基础测试
console.log(`DataCharts System Frontend v${SYSTEM_VERSION} 已加载`)
```

#### 创建后端主文件 `backend/app/main.py`
```python
"""
数据可视化系统后端主文件

根据设计文档规范提供数据处理和API服务
"""

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
import sys
import os

# 添加共享模块路径
sys.path.append(os.path.join(os.path.dirname(__file__), '..', '..', 'shared'))

from interfaces import *
from data_types import *

app = FastAPI(title="DataCharts System API", version="0.1.0")

# CORS 配置
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
async def root():
    """根路径"""
    return {"message": "DataCharts System API", "version": "0.1.0"}

@app.get("/health")
async def health_check():
    """健康检查"""
    return {"status": "healthy"}

# 基础测试
if __name__ == "__main__":
    import uvicorn
    print("DataCharts System Backend v0.1.0 启动中...")
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

#### 创建桌面客户端主文件 `desktop/src/main.py`
```python
"""
数据可视化系统桌面客户端主文件

使用PyQt6提供本地数据可视化功能
"""

import sys
import os
from PyQt6.QtWidgets import QApplication, QMainWindow, QLabel
from PyQt6.QtCore import Qt

# 添加共享模块路径
sys.path.append(os.path.join(os.path.dirname(__file__), '..', '..', 'shared'))

from interfaces import *
from data_types import *

class MainWindow(QMainWindow):
    """主窗口类"""
    
    def __init__(self):
        super().__init__()
        self.setWindowTitle("DataCharts System v0.1.0")
        self.setGeometry(100, 100, 800, 600)
        
        # 临时标签
        label = QLabel("DataCharts System - 数据可视化系统", self)
        label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.setCentralWidget(label)

def main():
    """主函数"""
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    
    print("DataCharts System Desktop v0.1.0 已启动")
    sys.exit(app.exec())

if __name__ == '__main__':
    main()
```

### 步骤 6: 生成配置文件

#### 创建 .gitignore
```gitignore
# Python
__pycache__/
*.py[cod]
*.pyo
*.pyd
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.npm
.eslintcache

# IDEs
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
logs/
*.log

# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Database
*.db
*.sqlite
```

### 步骤 7: 编译验证
```bash
cd code/DataCharts-System

# 检查Python代码
python -m py_compile shared/data_types.py
python -m py_compile shared/interfaces.py
python -m py_compile backend/app/main.py
python -m py_compile desktop/src/main.py

# 检查前端代码（如果安装了Node.js）
cd frontend && npm install && npm run build
```

## 成功标准
- [ ] 项目目录结构正确创建
- [ ] 根据设计文档生成核心数据结构
- [ ] 根据设计文档生成外部接口定义（仅函数签名）
- [ ] 创建必要的配置文件
- [ ] Python代码编译成功
- [ ] 前端代码构建成功（如果可用）
- [ ] 所有结构实现必要的类型定义
- [ ] 无实现细节 - 仅结构和接口定义

## 输出文件
- `code/DataCharts-System/`: 完整的数据可视化系统目录结构
- `shared/data_types.py`: 数据结构定义
- `shared/interfaces.py`: 接口定义
- `frontend/`, `backend/`, `desktop/`: 各端基础文件
- 配置文件：package.json, requirements.txt, .gitignore

## 触发机制
此任务可通过以下方式触发：
1. 手动执行：按照详细步骤手动操作
2. 脚本执行：`./task-runner.sh 03`
3. AI辅助：使用AI基于验证的提示词生成代码

## 下一任务
成功完成后，继续执行 **04-检查合规性.md** 进行合规性验证。

## 注意事项
- 此任务仅生成框架结构 - 无功能实现
- 所有数据结构必须与设计文档完全匹配
- 所有接口必须与设计文档完全匹配
- 代码必须编译通过，但函数可以使用 `pass` 或 `TODO` 占位符
- 专注于结构正确性，而非实现细节